<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>影像学术研究计算工具 v3.2</title>
    <style>
        :root {
            --primary: #4f46e5;
            --secondary: #7c3aed;
            --success: #22c55e;
            --warning: #f59e0b;
            --error: #ef4444;
            --bg: #ffffff;
            --text: #1e293b;
            --card: #f8fafc;
            --border: #e2e8f0;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --normal-color: #22c55e;
            --renal-color: #f59e0b;
            --metformin-color: #ef4444;
            --heart-color: #3b82f6;
        }

        [data-theme="dark"] {
            --primary: #6366f1;
            --secondary: #8b5cf6;
            --success: #10b981;
            --warning: #f59e0b;
            --error: #f87171;
            --bg: #0f172a;
            --text: #e2e8f0;
            --card: #1e293b;
            --border: #374151;
            --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.3);
            --heart-color: #60a5fa;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Microsoft YaHei', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--text);
            min-height: 100vh;
            padding: 20px;
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--shadow);
            position: relative;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            position: relative;
        }

        .theme-toggle {
            position: absolute;
            top: 0;
            right: 0;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 25px;
            padding: 8px 16px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: var(--text);
        }

        .theme-toggle:hover {
            background: var(--primary);
            color: white;
            transform: translateY(-2px);
        }

        h1 {
            font-size: 2.8em;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
        }

        .subtitle {
            font-size: 1.2em;
            color: var(--text);
            opacity: 0.8;
            margin-bottom: 20px;
        }

        .developer-info {
            margin: 15px 0;
            padding: 10px 20px;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 600;
            display: inline-block;
        }

        /* 电子钟样式 */
        .clock-container {
            background: linear-gradient(145deg, #ffffff, #f8f9fa);
            border: 2px solid transparent;
            background-clip: padding-box;
            border-radius: 16px;
            padding: 20px;
            margin: 25px 0;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 
                0 8px 32px rgba(79, 70, 229, 0.1),
                inset 0 1px 3px rgba(255, 255, 255, 0.8),
                inset 0 -1px 2px rgba(0, 0, 0, 0.05);
            position: relative;
            overflow: hidden;
        }

        .clock-container::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            padding: 2px;
            background: linear-gradient(135deg, var(--primary), var(--secondary), #22c55e, var(--primary));
            border-radius: 16px;
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask-composite: exclude;
            z-index: -1;
            animation: borderGlow 3s ease-in-out infinite alternate;
        }

        @keyframes borderGlow {
            0% { opacity: 0.6; transform: scale(1); }
            100% { opacity: 1; transform: scale(1.02); }
        }

        .clock-container:hover {
            transform: translateY(-2px);
            box-shadow: 
                0 12px 40px rgba(79, 70, 229, 0.15),
                inset 0 1px 3px rgba(255, 255, 255, 0.9),
                inset 0 -1px 2px rgba(0, 0, 0, 0.05);
        }

        .digits-container {
            display: flex;
            gap: 12px;
            align-items: center;
        }

        .digit-group {
            display: flex;
            gap: 8px;
        }

        .digit {
            position: relative;
            width: 60px;
            height: 100px;
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            padding: 8px;
            border-radius: 8px;
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.1),
                inset 0 1px 2px rgba(255, 255, 255, 0.8),
                inset 0 -1px 1px rgba(0, 0, 0, 0.05);
            border: 1px solid rgba(79, 70, 229, 0.1);
            transition: all 0.3s ease;
        }

        .digit:hover {
            transform: translateY(-1px);
            box-shadow: 
                0 4px 12px rgba(0, 0, 0, 0.15),
                inset 0 1px 2px rgba(255, 255, 255, 0.9),
                inset 0 -1px 1px rgba(0, 0, 0, 0.05);
        }

        .segment {
            position: absolute;
            background: transparent;
            border-radius: 3px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* 修复后的数字段样式 - 白天模式：黑色透明背景无阴影 */
        .segment.active {
            background: #333333;
            /* 移除所有阴影效果 */
            box-shadow: none;
        }

        /* 水平段 */
        .segment-a { top: 8px; left: 12px; width: 36px; height: 8px; }
        .segment-d { bottom: 8px; left: 12px; width: 36px; height: 8px; }
        .segment-g { top: 50%; left: 12px; width: 36px; height: 8px; transform: translateY(-50%); }

        /* 垂直段 */
        .segment-b { top: 12px; right: 8px; width: 8px; height: 36px; }
        .segment-c { bottom: 12px; right: 8px; width: 8px; height: 36px; }
        .segment-e { bottom: 12px; left: 8px; width: 8px; height: 36px; }
        .segment-f { top: 12px; left: 8px; width: 8px; height: 36px; }

        .clock-colon {
            font-size: 2.5rem;
            color: #333333;
            margin: 0 8px;
            font-weight: bold;
            text-shadow: 0 2px 4px rgba(51, 51, 51, 0.2);
            transition: all 0.3s ease;
        }

        .clock-label {
            font-size: 13px;
            color: var(--primary);
            text-align: center;
            margin-top: 12px;
            font-weight: 500;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
        }

        /* 暗色主题下的电子钟样式 */
        [data-theme="dark"] .clock-container {
            background: linear-gradient(145deg, #1e293b, #334155);
            box-shadow: 
                0 8px 32px rgba(0, 0, 0, 0.3),
                inset 0 1px 3px rgba(255, 255, 255, 0.1),
                inset 0 -1px 2px rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] .digit {
            background: linear-gradient(145deg, #334155, #475569);
            border: 1px solid rgba(99, 102, 241, 0.2);
            box-shadow: 
                0 2px 8px rgba(0, 0, 0, 0.3),
                inset 0 1px 2px rgba(255, 255, 255, 0.1),
                inset 0 -1px 1px rgba(0, 0, 0, 0.2);
        }

        [data-theme="dark"] .clock-colon {
            color: #ffffff;
            text-shadow: 0 0 8px rgba(255, 255, 255, 0.4);
        }

        /* 修复后的暗色主题数字段样式 - 夜间模式：白色透明背景无阴影 */
        [data-theme="dark"] .segment.active {
            background: #ffffff;
            /* 移除所有阴影效果 */
            box-shadow: none;
        }

        /* 患者分类选择器 */
        .patient-category-selector {
            background: var(--card);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            border: 2px solid var(--border);
        }

        .category-title {
            text-align: center;
            font-size: 1.8em;
            color: var(--primary);
            margin-bottom: 25px;
            font-weight: 700;
        }

        .category-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
        }

        .category-card {
            background: var(--bg);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .category-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            transition: all 0.3s ease;
        }

        .category-card.normal::before { background: var(--normal-color); }
        .category-card.renal::before { background: var(--renal-color); }
        .category-card.metformin::before { background: var(--metformin-color); }
        .category-card.heart::before { background: var(--heart-color); }

        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .category-card.active {
            border-color: var(--primary);
            transform: translateY(-3px);
            box-shadow: 0 8px 30px rgba(79, 70, 229, 0.2);
        }

        .category-card.normal.active {
            border-color: var(--normal-color);
            box-shadow: 0 8px 30px rgba(34, 197, 94, 0.2);
        }

        .category-card.renal.active {
            border-color: var(--renal-color);
            box-shadow: 0 8px 30px rgba(245, 158, 11, 0.2);
        }

        .category-card.metformin.active {
            border-color: var(--metformin-color);
            box-shadow: 0 8px 30px rgba(239, 68, 68, 0.2);
        }

        .category-card.heart.active {
            border-color: var(--heart-color);
            box-shadow: 0 8px 30px rgba(59, 130, 246, 0.2);
        }

        .category-icon {
            font-size: 3em;
            margin-bottom: 15px;
            display: block;
        }

        .category-name {
            font-size: 1.4em;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .category-description {
            font-size: 0.95em;
            color: var(--text);
            opacity: 0.7;
            line-height: 1.5;
        }

        .category-card.normal .category-name { color: var(--normal-color); }
        .category-card.renal .category-name { color: var(--renal-color); }
        .category-card.metformin .category-name { color: var(--metformin-color); }
        .category-card.heart .category-name { color: var(--heart-color); }

        /* 表单区域 */
        .form-container {
            display: none;
            animation: slideIn 0.5s ease;
        }

        .form-container.show {
            display: block;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            background: var(--card);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 25px;
            border: 1px solid var(--border);
            transition: all 0.3s ease;
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow);
        }

        .section-title {
            font-size: 1.3em;
            margin-bottom: 20px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title.normal { color: var(--normal-color); }
        .section-title.renal { color: var(--renal-color); }
        .section-title.metformin { color: var(--metformin-color); }
        .section-title.heart { color: var(--heart-color); }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            position: relative;
        }

        label {
            font-weight: 500;
            color: var(--text);
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: var(--error);
        }

        input, select {
            padding: 12px 16px;
            border: 2px solid var(--border);
            border-radius: 10px;
            font-size: 16px;
            background: var(--bg);
            color: var(--text);
            transition: all 0.3s ease;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
        }

        .input-hint {
            font-size: 12px;
            color: var(--text);
            opacity: 0.6;
            margin-top: 4px;
        }

        .input-error {
            border-color: var(--error) !important;
            background-color: rgba(239, 68, 68, 0.05);
        }

        .error-message {
            color: var(--error);
            font-size: 12px;
            margin-top: 4px;
            display: none;
        }

        .info-box {
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-size: 14px;
            line-height: 1.6;
            border-left: 4px solid;
        }

        .info-box.normal {
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            color: #065f46;
            border-left-color: var(--normal-color);
        }

        .info-box.renal {
            background: linear-gradient(135deg, #fef3c7, #fed7aa);
            color: #92400e;
            border-left-color: var(--renal-color);
        }

        .info-box.metformin {
            background: linear-gradient(135deg, #fecaca, #fca5a5);
            color: #991b1b;
            border-left-color: var(--metformin-color);
        }

        .info-box.heart {
            background: linear-gradient(135deg, #dbeafe, #bfdbfe);
            color: #1e3a8a;
            border-left-color: var(--heart-color);
        }

        /* 分级标准表格样式 */
        .grading-table {
            width: 100%;
            margin: 15px 0;
            border-collapse: collapse;
            font-size: 12px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .grading-table th {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 10px 8px;
            text-align: center;
            font-weight: 600;
            font-size: 11px;
        }

        .grading-table td {
            padding: 8px;
            border: 1px solid #e2e8f0;
            text-align: center;
            font-size: 11px;
        }

        .grading-table .grade-level {
            font-weight: 700;
            white-space: nowrap;
        }

        .grade-low { color: var(--normal-color); }
        .grade-moderate { color: var(--renal-color); }
        .grade-high { color: var(--metformin-color); }
        .grade-very-high { color: var(--error); }

        .btn {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(79, 70, 229, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-group {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .btn-secondary {
            background: var(--card);
            color: var(--text);
            border: 2px solid var(--border);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--border);
        }

        .results {
            background: var(--card);
            padding: 25px;
            border-radius: 15px;
            border: 1px solid var(--border);
            margin-top: 25px;
            display: none;
            animation: slideIn 0.5s ease;
        }

        .results.show { display: block; }

        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            margin-bottom: 12px;
            background: var(--bg);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
            transition: all 0.3s ease;
        }

        .result-item:hover {
            transform: translateX(5px);
            box-shadow: var(--shadow);
        }

        .result-label {
            font-weight: 500;
            color: var(--text);
        }

        .result-value {
            font-size: 1.2em;
            color: var(--primary);
            font-weight: 700;
        }

        .calc-type {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            margin-bottom: 20px;
            font-weight: 600;
            text-align: center;
            font-size: 14px;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            width: 0%;
            transition: width 0.3s ease;
        }

        .real-time-validation {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 18px;
        }

        .validation-success { color: var(--success); }
        .validation-error { color: var(--error); }

        .formula-display {
            background: var(--bg);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 10px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            color: var(--text);
            opacity: 0.8;
        }

        .disclaimer {
            background: linear-gradient(135deg, #fef7cd, #fed7aa);
            color: #92400e;
            padding: 20px;
            border-radius: 15px;
            border-left: 4px solid var(--warning);
            margin-top: 25px;
            font-size: 13px;
            line-height: 1.6;
        }

        .disclaimer h3 {
            margin-bottom: 15px;
            font-size: 16px;
            font-weight: 700;
        }

        .highlight {
            font-weight: 700;
            color: #b45309;
        }

        /* 暗色主题适配 */
        [data-theme="dark"] .grading-table {
            background: #1e293b;
        }

        [data-theme="dark"] .grading-table td {
            border-color: #374151;
        }

        @media (max-width: 768px) {
            body { padding: 10px; }
            .container { padding: 20px; }
            h1 { font-size: 2.2em; }
            .form-row { grid-template-columns: 1fr; gap: 15px; }
            .theme-toggle { position: relative; margin-bottom: 20px; }
            .btn-group { flex-direction: column; }
            
            .category-grid {
                grid-template-columns: 1fr;
                gap: 12px;
            }

            .grading-table {
                font-size: 10px;
            }

            .grading-table th,
            .grading-table td {
                padding: 6px 4px;
            }

            /* 移动端电子钟优化 */
            .clock-container {
                padding: 25px 15px;
                margin: 25px 0;
                border-radius: 20px;
            }
            
            .digits-container {
                gap: 10px;
                transform: scale(1.1);
            }
            
            .digit {
                width: 55px;
                height: 90px;
                border-radius: 10px;
                padding: 10px;
                box-shadow: 
                    0 4px 12px rgba(0, 0, 0, 0.15),
                    inset 0 2px 4px rgba(255, 255, 255, 0.8),
                    inset 0 -2px 3px rgba(0, 0, 0, 0.05);
            }
            
            .digit:hover {
                transform: translateY(-2px);
            }
            
            /* 移动端段更粗更清晰 */
            .segment-a, .segment-d, .segment-g {
                width: 35px;
                height: 6px;
                left: 10px;
            }
            
            .segment-b, .segment-c, .segment-e, .segment-f {
                width: 6px;
                height: 32px;
            }
            
            .segment-b, .segment-c {
                right: 10px;
            }
            
            .segment-e, .segment-f {
                left: 10px;
            }
            
            .segment-a { top: 10px; }
            .segment-d { bottom: 10px; }
            .segment-g { top: 50%; transform: translateY(-50%); }
            .segment-b { top: 14px; }
            .segment-c { bottom: 14px; }
            .segment-e { bottom: 14px; }
            .segment-f { top: 14px; }
            
            .clock-colon {
                font-size: 2.2rem;
                margin: 0 6px;
                font-weight: 900;
            }
            
            .clock-label {
                font-size: 14px;
                margin-top: 15px;
                font-weight: 600;
            }
        }

        @media print {
            body { background: white; color: black; }
            .container { background: white; box-shadow: none; }
            .btn, .theme-toggle, .patient-category-selector, .clock-container { display: none; }
            .no-print { display: none; }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <div class="theme-toggle" onclick="toggleTheme()">
                <span id="theme-icon">🌙</span>
                <span id="theme-text">夜间模式</span>
            </div>
            <h1>影像学术研究计算工具</h1>
            <div class="subtitle">CTA造影剂用量与BMI学术参考计算 v3.2</div>
            <div class="developer-info">
                💻 程序开发者：影像涛哥
            </div>
            
            <!-- 电子钟 -->
            <div class="clock-container">
                <div class="digits-container">
                    <div class="digit-group">
                        <div class="digit" id="hour-tens">
                            <div class="segment segment-a"></div>
                            <div class="segment segment-b"></div>
                            <div class="segment segment-c"></div>
                            <div class="segment segment-d"></div>
                            <div class="segment segment-e"></div>
                            <div class="segment segment-f"></div>
                            <div class="segment segment-g"></div>
                        </div>
                        <div class="digit" id="hour-ones">
                            <div class="segment segment-a"></div>
                            <div class="segment segment-b"></div>
                            <div class="segment segment-c"></div>
                            <div class="segment segment-d"></div>
                            <div class="segment segment-e"></div>
                            <div class="segment segment-f"></div>
                            <div class="segment segment-g"></div>
                        </div>
                    </div>
                    
                    <div class="clock-colon">:</div>
                    
                    <div class="digit-group">
                        <div class="digit" id="min-tens">
                            <div class="segment segment-a"></div>
                            <div class="segment segment-b"></div>
                            <div class="segment segment-c"></div>
                            <div class="segment segment-d"></div>
                            <div class="segment segment-e"></div>
                            <div class="segment segment-f"></div>
                            <div class="segment segment-g"></div>
                        </div>
                        <div class="digit" id="min-ones">
                            <div class="segment segment-a"></div>
                            <div class="segment segment-b"></div>
                            <div class="segment segment-c"></div>
                            <div class="segment segment-d"></div>
                            <div class="segment segment-e"></div>
                            <div class="segment segment-f"></div>
                            <div class="segment segment-g"></div>
                        </div>
                    </div>
                    
                    <div class="clock-colon">:</div>
                    
                    <div class="digit-group">
                        <div class="digit" id="sec-tens">
                            <div class="segment segment-a"></div>
                            <div class="segment segment-b"></div>
                            <div class="segment segment-c"></div>
                            <div class="segment segment-d"></div>
                            <div class="segment segment-e"></div>
                            <div class="segment segment-f"></div>
                            <div class="segment segment-g"></div>
                        </div>
                        <div class="digit" id="sec-ones">
                            <div class="segment segment-a"></div>
                            <div class="segment segment-b"></div>
                            <div class="segment segment-c"></div>
                            <div class="segment segment-d"></div>
                            <div class="segment segment-e"></div>
                            <div class="segment segment-f"></div>
                            <div class="segment segment-g"></div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="clock-label">当前时间</div>
        </div>
        
        <!-- 患者分类选择器 -->
        <div class="patient-category-selector">
            <div class="category-title">请选择患者类型</div>
            <div class="category-grid">
                <div class="category-card normal" onclick="selectPatientType('normal')">
                    <div class="category-icon">👤</div>
                    <div class="category-name">正常患者</div>
                    <div class="category-description">
                        肾功能正常<br>
                        无二甲双胍用药史<br>
                        标准计算流程
                    </div>
                </div>
                
                <div class="category-card renal" onclick="selectPatientType('renal')">
                    <div class="category-icon">🫘</div>
                    <div class="category-name">肾功能异常患者</div>
                    <div class="category-description">
                        肾功能不全<br>
                        需要eGFR评估<br>
                        造影剂用量调整
                    </div>
                </div>
                
                <div class="category-card metformin" onclick="selectPatientType('metformin')">
                    <div class="category-icon">💊</div>
                    <div class="category-name">二甲双胍用药患者</div>
                    <div class="category-description">
                        服用二甲双胍<br>
                        需要风险评估<br>
                        特殊处理方案
                    </div>
                </div>

                <div class="category-card heart" onclick="selectPatientType('heart')">
                    <div class="category-icon">❤️</div>
                    <div class="category-name">心功能不全患者</div>
                    <div class="category-description">
                        心功能异常<br>
                        需要NYHA分级评估<br>
                        造影剂用量限制
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 简化的演示区域 -->
        <div class="info-box normal">
            <h3>电子钟样式修复完成</h3>
            <p><strong>修复内容：</strong></p>
            <ul>
                <li><strong>白天模式：</strong>数字显示为黑色，背景透明，无阴影效果</li>
                <li><strong>夜间模式：</strong>数字显示为白色，背景透明，无阴影效果</li>
                <li><strong>保持原有：</strong>数码管容器的样式和动画效果保持不变</li>
                <li><strong>响应式：</strong>在移动端也能正确显示修复后的样式</li>
            </ul>
            <p>现在电子钟的数字段在白天显示为纯黑色透明背景，在夜间模式下显示为纯白色透明背景，完全去除了阴影效果。</p>
        </div>

        <div class="disclaimer">
            <h3>⚠️ 重要使用声明</h3>
            <p><span class="highlight">专业背景要求：</span>使用者须是在医学影像科工作的专业人员，熟悉CT检查流程和造影剂使用规范。</p>
            <p><span class="highlight">设备依据：</span>本工具计算公式基于联影CT960+设备的技术参数和临床研究数据。</p>
            <p><span class="highlight">学术用途：</span>仅供影像技术教学、学术研究使用，严禁用于临床诊断或治疗决策。</p>
            <p style="margin-top: 15px; font-weight: 700; color: #b45309; border-top: 1px solid #fed7aa; padding-top: 15px;">
                开发者不承担任何直接或间接的法律责任；使用即表示同意本声明。
            </p>
        </div>
    </div>

    <script>
        // 7段数码管数字配置（a-g段）
        const digitConfig = {
            '0': [1, 1, 1, 1, 1, 1, 0],
            '1': [0, 1, 1, 0, 0, 0, 0],
            '2': [1, 1, 0, 1, 1, 0, 1],
            '3': [1, 1, 1, 1, 0, 0, 1],
            '4': [0, 1, 1, 0, 0, 1, 1],
            '5': [1, 0, 1, 1, 0, 1, 1],
            '6': [1, 0, 1, 1, 1, 1, 1],
            '7': [1, 1, 1, 0, 0, 0, 0],
            '8': [1, 1, 1, 1, 1, 1, 1],
            '9': [1, 1, 1, 1, 0, 1, 1]
        };

        // 全局状态管理
        const appState = {
            isDarkMode: false,
            currentPatientType: null,
            currentResults: null
        };

        // 电子钟相关函数
        function updateClock() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            const seconds = now.getSeconds();

            // 格式化时间各部分
            const hoursStr = hours.toString().padStart(2, '0');
            const minutesStr = minutes.toString().padStart(2, '0');
            const secondsStr = seconds.toString().padStart(2, '0');

            // 更新数码管显示
            displayDigit(document.getElementById('hour-tens'), hoursStr[0]);
            displayDigit(document.getElementById('hour-ones'), hoursStr[1]);
            displayDigit(document.getElementById('min-tens'), minutesStr[0]);
            displayDigit(document.getElementById('min-ones'), minutesStr[1]);
            displayDigit(document.getElementById('sec-tens'), secondsStr[0]);
            displayDigit(document.getElementById('sec-ones'), secondsStr[1]);
        }

        // 显示数字到7段数码管
        function displayDigit(digitElement, number) {
            const segments = digitElement.querySelectorAll('.segment');
            const config = digitConfig[number] || digitConfig['0'];

            segments.forEach((segment, index) => {
                if (config[index] === 1) {
                    segment.classList.add('active');
                } else {
                    segment.classList.remove('active');
                }
            });
        }

        // 主题切换功能 - 简化版本，不再需要动态设置样式
        function toggleTheme() {
            try {
                appState.isDarkMode = !appState.isDarkMode;
                const body = document.body;
                const themeIcon = document.getElementById('theme-icon');
                const themeText = document.getElementById('theme-text');
                
                if (appState.isDarkMode) {
                    body.setAttribute('data-theme', 'dark');
                    if (themeIcon) themeIcon.textContent = '☀️';
                    if (themeText) themeText.textContent = '日间模式';
                } else {
                    body.removeAttribute('data-theme');
                    if (themeIcon) themeIcon.textContent = '🌙';
                    if (themeText) themeText.textContent = '夜间模式';
                }
                
                // 由于已经在CSS中定义了正确的样式，这里不再需要JavaScript动态修改
                console.log(`主题已切换至: ${appState.isDarkMode ? '夜间' : '日间'}模式`);
                
            } catch (error) {
                console.error('主题切换出错:', error);
                showNotification('⚠️ 主题切换失败', 'warning');
            }
        }

        // 患者类型选择
        function selectPatientType(type) {
            appState.currentPatientType = type;
            
            // 更新UI状态
            document.querySelectorAll('.category-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector(`.category-card.${type}`).classList.add('active');
            
            showNotification(`已选择：${getPatientTypeName(type)}`, 'success');
        }

        function getPatientTypeName(type) {
            const names = {
                'normal': '正常患者',
                'renal': '肾功能异常患者',
                'metformin': '二甲双胍用药患者',
                'heart': '心功能不全患者'
            };
            return names[type] || type;
        }

        // 通知显示函数
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed; top: 20px; right: 20px; padding: 15px 20px;
                border-radius: 8px; color: white; font-weight: 500; z-index: 1000;
                opacity: 0; transition: opacity 0.3s ease; max-width: 300px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            `;
            
            switch(type) {
                case 'success': notification.style.background = '#22c55e'; break;
                case 'error': notification.style.background = '#ef4444'; break;
                case 'warning': notification.style.background = '#f59e0b'; break;
                default: notification.style.background = '#3b82f6';
            }
            
            notification.textContent = message;
            document.body.appendChild(notification);
            
            setTimeout(() => notification.style.opacity = '1', 10);
            
            setTimeout(() => {
                notification.style.opacity = '0';
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // 页面初始化
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // 初始化电子钟
                updateClock();
                setInterval(updateClock, 1000); // 每秒更新一次
                
                showNotification('✅ 电子钟样式修复完成！', 'success');
                
            } catch (error) {
                console.error('页面初始化出错:', error);
                showNotification('⚠️ 页面初始化过程中出现问题', 'warning');
            }
        });

        // 全局错误处理
        window.addEventListener('error', function(event) {
            console.error('全局错误:', event.error);
        });

        window.addEventListener('unhandledrejection', function(event) {
            console.error('未处理的Promise拒绝:', event.reason);
        });
    </script>
</body>
</html>
